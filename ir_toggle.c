#include <furi.h>
#include <input/input.h>
#include <infrared/infrared.h>
#include <stdbool.h>

typedef struct {
    bool power;
    bool r;
    bool u;
    bool d;
    bool l;
    bool a;
    bool b;
    bool ok;
} IrAppState;

#define COUNT_OF(x) (sizeof(x)/sizeof((x)[0]))

// -------------------- TWOJE KODY RAW --------------------

// Power
const uint32_t power1_data[] = {962,807,1845,805,961,805,962,1690,961,807,1845,1689,1846,808,958,835,932,807,960,806,961,805,963,806,961,1689,962,806,1846,1688,1847,63586,960,805,1847,805,961,807,960,1690,961,807,1845,1688,1847,805,961,806,961,835,932,807,960,806,961,807,960,1690,961,805,1847,1718,1817};
const uint32_t power2_data[] = {906,861,906,861,1791,861,905,1745,906,862,1790,1744,1791,860,906,862,905,862,905,861,906,862,905,862,905,1745,906,862,1790,861,905,860,907,63640,958,808,959,806,1846,807,959,1691,960,806,1846,1691,1792,856,962,807,960,807,960,807,961,806,961,806,961,1691,960,807,1793,858,960,807,960};

// R
const uint32_t r1_data[] = {960,807,1845,806,960,806,961,1689,962,805,1847,1688,1846,806,960,804,963,808,960,807,960,807,960,1691,960,835,1817,807,959,1693,1791};
const uint32_t r2_data[] = {906,861,906,861,1791,859,907,1745,906,861,1791,1743,1792,860,906,863,904,861,906,860,907,862,905,1746,905,859,1793,859,907,859,908,861,906,63636,906,859,908,861,1791,859,907,1745,906,860,1793,1744,1791,859,907,863,904,861,906,861,906,862,905,1745,906,860,1792,861,905,860,907,861,906};

// U
const uint32_t u1_data[] = {959,807,1793,858,960,808,959,1691,960,808,1792,1742,1793,858,959,810,957,809,958,807,960,809,958,1692,1793,857,909,859,908,1744,907,861,906,62752,960,807,1845,808,958,807,960,1691,960,807,1844,1693,1791,857,961,808,959,807,960,808,959,807,960,1694,1790,857,961,808,959,1694,957,807,960};
const uint32_t u2_data[] = {963,804,963,805,1794,858,961,1690,961,806,1846,1688,1847,804,963,806,961,806,961,806,961,806,961,1693,1843,808,958,806,961,806,961,1690,961,62700,960,805,962,807,1792,858,961,1690,961,805,1794,1741,1794,858,961,805,962,806,961,805,962,807,960,1690,1793,859,960,805,962,807,960,1690,961};

// D
const uint32_t d1_data[] = {882,885,1767,884,882,887,880,1771,880,915,1737,1769,1766,884,909,861,880,886,881,886,881,885,882,1771,906,860,907,860,1765,1768,909,859,908,62752,907,861,1764,885,908,858,909,1742,909,860,1765,1771,1764,885,908,888,879,860,907,861,906,860,907,1743,908,858,909,859,1793,1771,879,860,907};
const uint32_t d2_data[] = {881,885,882,886,1766,886,880,1770,881,885,1767,1769,1766,884,909,859,908,860,907,858,909,860,907,1743,908,860,907,860,1766,884,909,1743,908,62752,907,860,907,860,1765,884,909,1742,909,859,1766,1769,1766,886,907,859,908,859,908,859,908,858,909,1742,909,860,907,859,1793,858,908,1744,907};

// L
const uint32_t l1_data[] = {962,805,1847,805,961,806,961,1690,961,808,1844,1692,1843,805,961,807,960,806,961,810,957,806,961,1689,1847,1690,1845,1688,1847,63581,961,807,1845,805,961,806,961,1690,961,805,1847,1689,1793,858,961,806,961,808,959,808,959,807,960,1690,1845,1691,1844,1689,1846};
const uint32_t l2_data[] = {881,886,881,885,1767,886,880,1771,880,886,1766,1798,1737,884,882,885,882,885,909,860,881,887,880,1770,1766,1768,1767,885,908,859,908,63636,907,862,879,885,1767,886,907,1744,907,858,1768,1771,1764,886,907,860,880,886,908,858,909,859,908,1743,1766,1769,1766,885,908,861,906};

// A
const uint32_t a1_data[] = {908,861,1791,858,908,859,908,1744,907,859,1793,1743,1792,858,908,860,907,859,908,859,959,1693,1792,858,959,808,908,860,907,1744,959,810,957,62700,961,805,1847,804,963,806,961,1690,961,805,1847,1689,1846,805,961,807,960,806,961,806,961,1689,1847,805,961,807,960,806,961,1690,961,805,962};
const uint32_t a2_data[] = {959,806,961,807,1845,835,931,1690,961,807,1844,1690,1845,807,960,806,961,808,959,808,959,1691,1845,805,961,806,961,809,958,808,959,1690,962,62699,960,835,932,806,1846,834,932,1691,960,807,1845,1691,1844,806,960,805,962,807,960,808,959,1690,1794,857,961,806,961,807,960,808,959,1691,960};

// B
const uint32_t b1_data[] = {906,859,1793,858,908,860,907,1744,907,860,1792,1743,1792,861,905,859,908,858,909,861,906,1742,1794,860,906,1743,1793,1741,1794,63634,908,859,1793,859,907,859,908,1743,908,861,1791,1741,1794,857,909,859,908,860,907,859,908,1742,1794,862,904,1745,1791,1741,1794};
const uint32_t b2_data[] = {960,805,962,806,1846,805,961,1690,961,805,1847,1690,1845,805,961,805,962,805,962,807,960,1690,1793,858,961,1689,1847,804,962,806,961,63581,962,805,962,806,1846,805,961,1689,962,805,1847,1689,1846,805,961,806,961,808,959,806,961,1690,1846,805,961,1690,1846,804,962,807,960};

// OK
const uint32_t ok1_data[] = {877,918,1734,885,881,889,878,1773,878,891,1761,1770,1765,886,955,843,924,812,955,815,952,813,954,1698,1763,1771,953,815,952,812,955,817,950,62701,952,814,1836,814,960,810,957,1690,954,813,1837,1697,1838,814,953,813,961,808,959,808,952,814,960,1692,1835,1698,960,836,931,836,931,836,931,62694,952,813,1838,813,961,809,951,1697,960,807,1837,1727,1808,814,960,808,959,807,960,809,958,807,960,1692,1844,1689,960,807,960,808,959,806,961};
const uint32_t ok2_data[] = {955,811,906,862,1790,860,906,1743,908,860,1792,1744,1791,859,907,862,905,862,905,861,906,860,907,1746,1790,1743,906,860,1792,1744,905,62749,957,809,958,807,1845,806,960,1720,931,837,1815,1689,1846,810,956,808,959,808,959,808,959,836,931,1691,1845,1689,961,807,1845,1689,961,62696,957,809,958,836,1816,805,961,1691,960,807,1845,1690,1844,805,961,807,960,807,960,807,960,808,959,1692,1844,1688,961,806,1846,1692,957};

// -------------------- /TWOJE KODY RAW --------------------

static void send_toggle(bool* state, const uint32_t* d1, size_t size1,
                        const uint32_t* d2, size_t size2) {
    if(*state) {
        infrared_send_raw(d1, size1, 38000, 0.33f);
    } else {
        infrared_send_raw(d2, size2, 38000, 0.33f);
    }
    *state = !(*state);
}

int32_t ir_toggle_app(void* p) {
    UNUSED(p);
    IrAppState state = {0};
    InputEvent input;

    while(1) {
        if(furi_hal_input_get_event(&input, 100)) {
            if(input.type == InputTypePress) {
                switch(input.key) {
                    case InputKeyUp:    send_toggle(&state.u, u1_data, COUNT_OF(u1_data), u2_data, COUNT_OF(u2_data)); break;
                    case InputKeyDown:  send_toggle(&state.d, d1_data, COUNT_OF(d1_data), d2_data, COUNT_OF(d2_data)); break;
                    case InputKeyLeft:  send_toggle(&state.l, l1_data, COUNT_OF(l1_data), l2_data, COUNT_OF(l2_data)); break;
                    case InputKeyRight: send_toggle(&state.r, r1_data, COUNT_OF(r1_data), r2_data, COUNT_OF(r2_data)); break;
                    case InputKeyOk:    send_toggle(&state.ok, ok1_data, COUNT_OF(ok1_data), ok2_data, COUNT_OF(ok2_data)); break;
                    case InputKeyBack:  send_toggle(&state.power, power1_data, COUNT_OF(power1_data), power2_data, COUNT_OF(power2_data)); break;
                    default: break;
                }
            }
            if(input.type == InputTypeLong) {
                switch(input.key) {
                    case InputKeyOk:    send_toggle(&state.a, a1_data, COUNT_OF(a1_data), a2_data, COUNT_OF(a2_data)); break;
                    case InputKeyBack:  send_toggle(&state.b, b1_data, COUNT_OF(b1_data), b2_data, COUNT_OF(b2_data)); break;
                    default: break;
                }
            }
        }
    }
    return 0;
}
